Version 4
SHEET 1 3508 1328
WIRE -16 -880 -640 -880
WIRE 224 -880 -16 -880
WIRE 544 -880 224 -880
WIRE 752 -880 544 -880
WIRE 1360 -880 752 -880
WIRE 1600 -880 1360 -880
WIRE 752 -848 752 -880
WIRE 544 -832 544 -880
WIRE -1024 -736 -1024 -768
WIRE -880 -736 -1024 -736
WIRE -16 -736 -16 -880
WIRE 224 -736 224 -880
WIRE 752 -736 752 -768
WIRE 1360 -720 1360 -880
WIRE 544 -688 544 -752
WIRE 688 -688 544 -688
WIRE 544 -672 544 -688
WIRE 1600 -672 1600 -880
WIRE 1008 -640 752 -640
WIRE 1136 -640 1008 -640
WIRE 1312 -640 1216 -640
WIRE 480 -624 416 -624
WIRE -1024 -544 -1024 -736
WIRE -880 -544 -880 -736
WIRE 1008 -544 1008 -640
WIRE -16 -528 -16 -656
WIRE 224 -528 224 -656
WIRE 544 -528 544 -576
WIRE 112 -480 48 -480
WIRE 160 -480 112 -480
WIRE 416 -448 416 -624
WIRE 528 -448 416 -448
WIRE 752 -448 752 -640
WIRE 752 -448 592 -448
WIRE 112 -400 112 -480
WIRE 224 -400 224 -432
WIRE 224 -400 112 -400
WIRE -1024 -384 -1024 -464
WIRE -880 -384 -880 -480
WIRE -880 -384 -1024 -384
WIRE -848 -384 -880 -384
WIRE 1360 -384 1360 -624
WIRE 1600 -384 1600 -608
WIRE 1600 -384 1360 -384
WIRE -848 -352 -848 -384
WIRE -16 -336 -16 -432
WIRE 416 -336 416 -448
WIRE 416 -336 -16 -336
WIRE 1008 -336 1008 -480
WIRE 1360 -336 1360 -384
WIRE -1024 -304 -1024 -384
WIRE 1744 -288 1712 -288
WIRE 1856 -288 1824 -288
WIRE -880 -272 -880 -384
WIRE -16 -224 -16 -336
WIRE 224 -224 224 -400
WIRE -1024 -176 -1024 -224
WIRE -880 -176 -880 -208
WIRE -880 -176 -1024 -176
WIRE -544 -176 -608 -176
WIRE -432 -176 -480 -176
WIRE -272 -176 -352 -176
WIRE -160 -176 -272 -176
WIRE -80 -176 -160 -176
WIRE 320 -176 288 -176
WIRE 352 -176 320 -176
WIRE 480 -176 432 -176
WIRE 496 -176 480 -176
WIRE 544 -176 496 -176
WIRE 1008 -176 1008 -272
WIRE 1008 -176 624 -176
WIRE 1360 -176 1360 -256
WIRE 1360 -176 1008 -176
WIRE 1568 -176 1360 -176
WIRE 1712 -176 1712 -288
WIRE 1712 -176 1568 -176
WIRE 1744 -176 1712 -176
WIRE 1856 -176 1856 -288
WIRE 1856 -176 1824 -176
WIRE 2016 -176 1856 -176
WIRE 2096 -176 2016 -176
WIRE 2400 -176 2368 -176
WIRE 2416 -176 2400 -176
WIRE 2592 -176 2496 -176
WIRE -1024 -160 -1024 -176
WIRE 2752 -160 2720 -160
WIRE 2880 -160 2832 -160
WIRE 2912 -160 2880 -160
WIRE 2992 -160 2912 -160
WIRE 3040 -160 2992 -160
WIRE 3072 -160 3040 -160
WIRE 2016 -144 2016 -176
WIRE 2096 -144 2016 -144
WIRE 2400 -144 2400 -176
WIRE 752 -128 752 -448
WIRE 752 -128 640 -128
WIRE 864 -128 752 -128
WIRE 1568 -128 1568 -176
WIRE 496 -112 496 -176
WIRE 496 -112 432 -112
WIRE 640 -112 640 -128
WIRE 2016 -112 2016 -144
WIRE -160 -96 -160 -176
WIRE 2912 -96 2912 -160
WIRE 2992 -96 2992 -160
WIRE 3040 -96 3040 -160
WIRE -272 -80 -272 -176
WIRE 432 -80 432 -112
WIRE 496 -80 496 -112
WIRE 2880 -80 2880 -160
WIRE -16 -64 -16 -128
WIRE 0 -64 -16 -64
WIRE 96 -64 80 -64
WIRE 144 -64 96 -64
WIRE 224 -64 224 -128
WIRE 1008 -64 1008 -176
WIRE 1360 -64 1360 -176
WIRE 752 -48 752 -128
WIRE 2400 -48 2400 -80
WIRE 864 -32 864 -128
WIRE 1568 -16 1568 -64
WIRE 432 0 432 -16
WIRE 496 0 496 -16
WIRE 496 0 432 0
WIRE 640 0 640 -32
WIRE 688 0 640 0
WIRE 2016 16 2016 -32
WIRE 2096 16 2096 -144
WIRE 2096 16 2016 16
WIRE 2288 16 2288 -176
WIRE 2400 16 2352 16
WIRE 2464 16 2400 16
WIRE 2592 16 2592 -176
WIRE 2592 16 2528 16
WIRE -272 48 -272 -16
WIRE -160 48 -160 -16
WIRE -160 48 -272 48
WIRE -80 48 -160 48
WIRE 640 48 640 0
WIRE 2016 48 2016 16
WIRE 2880 48 2880 -16
WIRE 2912 48 2912 -16
WIRE 2912 48 2880 48
WIRE 2992 48 2992 -16
WIRE 2992 48 2912 48
WIRE 3040 48 3040 -32
WIRE 3040 48 2992 48
WIRE 2400 80 2400 16
WIRE -1216 96 -1232 96
WIRE -1040 96 -1216 96
WIRE -80 96 -80 48
WIRE 496 96 496 80
WIRE 1568 96 1568 64
WIRE 2880 96 2880 48
WIRE -160 128 -160 48
WIRE -880 144 -880 96
WIRE 640 144 640 128
WIRE 752 144 752 48
WIRE 752 144 640 144
WIRE 864 144 864 32
WIRE 864 144 752 144
WIRE 1008 144 1008 0
WIRE -1216 160 -1216 96
WIRE 96 192 96 -64
WIRE 2016 192 2016 128
WIRE 1360 208 1360 16
WIRE 1616 208 1360 208
WIRE 2400 208 2400 160
WIRE -80 240 -80 176
WIRE 32 240 -80 240
WIRE -1216 288 -1216 240
WIRE -1040 288 -1040 240
WIRE -1040 288 -1216 288
WIRE -80 304 -80 240
WIRE 96 352 96 288
WIRE 96 352 -16 352
WIRE 1360 368 1360 208
WIRE 752 384 752 144
WIRE 1008 384 1008 208
WIRE 1008 384 752 384
WIRE 1136 384 1008 384
WIRE 1312 384 1216 384
WIRE 752 400 752 384
WIRE 1616 400 1616 208
WIRE 96 448 96 352
WIRE 560 448 352 448
WIRE 688 448 560 448
WIRE -1216 464 -1216 288
WIRE 352 480 352 448
WIRE 560 480 560 448
WIRE 752 528 752 496
WIRE 752 528 624 528
WIRE 752 544 752 528
WIRE 352 624 352 560
WIRE -80 704 -80 400
WIRE -80 704 -640 704
WIRE 96 704 96 528
WIRE 96 704 -80 704
WIRE 560 704 560 576
WIRE 560 704 96 704
WIRE 752 704 752 624
WIRE 752 704 560 704
WIRE 1360 704 1360 464
WIRE 1360 704 752 704
WIRE 1616 704 1616 464
WIRE 1616 704 1360 704
FLAG 496 96 0
FLAG -608 -176 IN
FLAG -1040 96 IN
FLAG -640 704 B-
FLAG -640 -880 B+
FLAG -848 -352 0
FLAG -1024 -768 B+
FLAG -1024 -160 B-
FLAG 2096 -176 OUT
FLAG -160 128 0
FLAG 2880 96 0
FLAG 352 624 0
FLAG 320 -176 NEG_IN
FLAG 480 -176 FB
FLAG 1568 96 0
FLAG 2400 -48 0
FLAG 2400 208 0
FLAG 2016 192 0
FLAG 544 -528 0
FLAG -880 144 0
FLAG -1216 464 0
SYMBOL npn 32 192 R0
SYMATTR InstName Q15
SYMATTR Value 2N5550
SYMBOL res 80 432 R0
SYMATTR InstName R5
SYMATTR Value 470
SYMBOL res -96 80 R0
SYMATTR InstName R6
SYMATTR Value 4.7k
SYMBOL npn -80 -224 R0
SYMATTR InstName Q1
SYMATTR Value 2N5550
SYMBOL npn 288 -224 M0
SYMATTR InstName Q2
SYMATTR Value 2N5550
SYMBOL voltage -1040 144 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR Value2 AC 0
SYMATTR InstName V2
SYMATTR Value PULSE(-1.2 1.2 0.5m 1n 1n 0.5m 1m)
SYMBOL voltage -1024 -320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V3
SYMATTR Value 40
SYMBOL res 640 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 22k
SYMBOL res 480 -16 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL pnp 688 -640 M180
SYMATTR InstName Q6
SYMATTR Value BD140C
SYMBOL res 1344 -352 R0
SYMATTR InstName R16
SYMATTR Value 0.33
SYMBOL res 1344 -80 R0
SYMATTR InstName R17
SYMATTR Value 0.33
SYMBOL cap 480 -80 R0
SYMATTR InstName C4
SYMATTR Value 220µ
SYMBOL res 736 -864 R0
SYMATTR InstName R10
SYMATTR Value 100
SYMBOL res -176 -112 R0
SYMATTR InstName R2
SYMATTR Value 22k
SYMBOL cap -288 -80 R0
SYMATTR InstName C2
SYMATTR Value 68p
SYMBOL res -336 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 150
SYMBOL pnp 48 -432 R180
SYMATTR InstName Q4
SYMATTR Value 2N5401
SYMBOL pnp 160 -432 M180
SYMATTR InstName Q3
SYMATTR Value 2N5401
SYMBOL npn 688 400 R0
SYMATTR InstName Q8
SYMATTR Value BD139C
SYMBOL res 736 528 R0
SYMATTR InstName R14
SYMATTR Value 100
SYMBOL res 336 464 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res -32 -752 R0
SYMATTR InstName R3
SYMATTR Value 470
SYMBOL res 208 -752 R0
SYMATTR InstName R4
SYMATTR Value 470
SYMBOL cap 592 -464 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 220p
SYMBOL npn 688 -48 R0
SYMATTR InstName Q7
SYMATTR Value BD139C
SYMBOL res 624 -128 R0
SYMATTR InstName R11
SYMATTR Value 4.7k
SYMBOL res 624 32 R0
SYMATTR InstName R12
SYMATTR Value 410
SYMBOL cap 1552 -128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res 1552 -32 R0
SYMATTR InstName R20
SYMATTR Value 10
SYMBOL voltage 448 -176 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 -4 56 VBottom 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value ""
SYMATTR Value2 AC 1
SYMBOL voltage -1024 -560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V1
SYMATTR Value 40
SYMBOL ind 2736 -144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L102
SYMATTR Value 0.43m
SYMBOL res 2736 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R114
SYMATTR Value 6
SYMBOL cap 2864 -80 R0
SYMATTR InstName C105
SYMATTR Value 240µ
SYMBOL ind 2976 -112 R0
SYMATTR InstName L103
SYMATTR Value 127m
SYMBOL res 2896 -112 R0
SYMATTR InstName R122
SYMATTR Value 137
SYMBOL cap 3024 -96 R0
SYMATTR InstName C111
SYMATTR Value 12µ
SYMBOL cap 848 -32 R0
SYMATTR InstName C6
SYMATTR Value 47µ
SYMBOL voltage -1216 144 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value SINE(0 0.3 1k)
SYMBOL diode 1616 -608 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMATTR Value RFUH5TF6S
SYMBOL diode 1632 464 R180
WINDOW 0 42 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMATTR Value RFUH5TF6S
SYMBOL res 96 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 100
SYMBOL res 240 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 100
SYMBOL res 2384 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 2k
SYMBOL res 2512 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 2k
SYMBOL cap 2384 -144 R0
SYMATTR InstName C7
SYMATTR Value 159.2n
SYMBOL cap 2288 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 79.62n
SYMBOL cap 2464 32 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C9
SYMATTR Value 79.62n
SYMBOL res 2384 64 R0
SYMATTR InstName R28
SYMATTR Value 1k
SYMBOL ind 2000 -128 R0
SYMATTR InstName L3
SYMATTR Value 1m
SYMBOL res 2000 32 R0
SYMATTR InstName R31
SYMATTR Value 8
SYMBOL nmos 1312 -720 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1312 464 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL res 1232 -656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 330
SYMBOL res 1232 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 330
SYMBOL pnp 480 -576 M180
SYMATTR InstName Q16
SYMATTR Value 2N5401
SYMBOL res 528 -848 R0
SYMATTR InstName R19
SYMATTR Value 1k
SYMBOL npn -16 304 M0
SYMATTR InstName Q11
SYMATTR Value 2N5550
SYMBOL npn 624 480 M0
SYMATTR InstName Q12
SYMATTR Value 2N5550
SYMBOL diode 992 -336 R0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL zener 1024 -480 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value UMZ5_1N
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL zener 992 0 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value UMZ5_1N
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL diode 1024 144 M0
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL res 1840 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10
SYMBOL ind 1728 -272 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µ
SYMBOL cap -896 -544 R0
SYMATTR InstName C10
SYMATTR Value 7m
SYMBOL cap -896 -272 R0
SYMATTR InstName C12
SYMATTR Value 7m
SYMBOL cap -480 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 33µ
TEXT -352 800 Left 2 ;.tran 0 200m 0 500n\n.four 1k 50 -1 v(out)\n.option plotwinsize 0
TEXT -344 752 Left 2 ;.ac dec 1000 1 10000k
TEXT 2768 96 Left 2 ;SPEAKER MODEL
TEXT 120 392 Left 2 ;-4.5V
TEXT 1256 352 Left 2 ;0V
TEXT 1808 328 Left 2 !.param Freq=1k
TEXT 1808 1072 Left 2 !.options plotwinsize=0 numdgt=15 NoOpiter
TEXT 1808 1040 Left 2 ;Simulation Parameters
TEXT 1808 1104 Left 2 !.option NoMarch
TEXT 1808 1000 Left 2 !.tran 0 {stop} {start} {maxstep}
TEXT 1808 808 Left 2 !.param numsamples=32
TEXT 1808 1136 Left 2 !.options gminsteps=0 srcsteps=500
TEXT 1808 712 Left 2 !.param period {1/f1}
TEXT 1808 872 Left 2 !.param stop {start+sampletime}
TEXT 2104 424 Left 2 ;It's often (meaning almost always) desirable to delay capturing samples for the FFT to let \nthe DC conditions in the circuit stabilize.  Larger capacitors in the circuit require higher \nvalues of delay.  But, they charge up based on time, not cycles of the test frequency.\nSo, this delay is in *seconds.*
TEXT 1808 424 Left 2 !.param SettleTime=300m
TEXT 1808 776 Left 2 !.param start {delaycycles*period}
TEXT 1808 936 Left 2 !.param fftpts {2**fftlen}
TEXT 1808 968 Left 2 !.param maxstep {period/fftpts}
TEXT 1808 744 Left 2 !.param delaycycles {ceil(delay/period)}
TEXT 1808 288 Left 3 ;Simulation Parameters - These are what you set for your simulation.
TEXT 1808 584 Left 2 !.param f1 {abs(Freq)}
TEXT 1808 680 Left 2 !.param delay {abs(SettleTime)}
TEXT 1808 648 Left 2 !.param fixedvin {abs(Vinput)*pkrms}
TEXT 1808 616 Left 2 !.param pkrms {sqrt(2)}
TEXT 1808 368 Left 2 !.param Vinput=1
TEXT 2104 368 Left 2 ;RMS value of generator voltage.
TEXT 1808 904 Left 2 !.param fftlen {16}
TEXT 1808 840 Left 2 !.param sampletime {numsamples*period}
TEXT 1808 1312 Left 2 !.four {Freq} V(out)
RECTANGLE Normal 3184 144 2640 -240 2
